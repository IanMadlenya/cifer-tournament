{% extends "layout.html" %}

{% block body %}
<div id="wrap">
  <h1>CIFEr 2014 Hedge Fund Tournament</h1>
  <table class="info-table">
    <tbody>
      <tr>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
        <th colspan="2">Portfolio</th>
        <th colspan="2">Market</th>
      </tr>
      <tr>
        <th>Symbol</th>
        <th>Asset</th>
        <th>Shares</th>
        <th>Value</th>
        <th>Bid</th>
        <th>Ask</th>
      </tr>
      {% for asset in assets %}
      <tr data-coord="{{ 1 if asset.is_call else 0 }},{{ asset.strike }},{{ asset.stock_id }}">
        <td>{{ asset.symbol }}</td>
        <td>{{ asset.name }}</td>
        <td>{{ asset.shares }}</td>
        <td>{{ "%.2f" | format(asset.value) }}</td>
        <td>{{ "%.2f" | format(asset.bid) }}</td>
        <td>{{ "%.2f" | format(asset.ask) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <p>{{ user.email }}</p>
  <form method=post>
    <input name="csrf_token" type="hidden" value="{{ csrf_token() }}">
    <button type=submit name=action value=logout>Sign Out</button></form>
  <p>Date: {{ " " }}{{ date }}</p>
  <p>Cash: ${{ "%.2f" | format(user.cash) }}</p>
  <h2>Trade</h2>
  <form id="tradeform" method=post>
    <input name="csrf_token" type="hidden" value="{{ csrf_token() }}">
    <div style="display:none">{{ tradeform.trade_asset }}</div>
    <table class="trade-table">
      <tbody>
        <tr>
          <td>Asset</td>
          <td id="trade_asset_name">(none selected)</td>
        </tr>
        <tr>
          <td>{{ tradeform.trade_qty.label }}</td>
          <td>{{ tradeform.trade_qty }}</td>
        </tr>
        <tr>
          <td>{{ tradeform.trade_position.label }}</td>
          <td>{{ tradeform.trade_position }}</td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td><button type=submit name=action value=trade>Submit</button></td>
        </tr>
      </tbody>
    </table>
  </form>
</div>
{% endblock %}

{% block js %}
<script>
  $(".trade-table input, .trade-table button").prop("disabled", true);
  $(".info-table tr").has("td").click(function() {
    $(".trade-table input, .trade-table button").prop("disabled", false);
    $("#trade_qty input").val("");
    $("#trade_asset_name").html($($(this).find("td")[0]).html() + " " + $($(this).find("td")[1]).html());
    $("#trade_asset").val($(this).attr("data-coord"));
    $("label[for=trade_position-1]").html((parseFloat($($(this).find("td")[2]).html()) > 0) ? "Sell" : "Short sell");
  });
</script>
{% endblock %}
